{% extends "base.html" %}

{% block title %}Analyze Developer - DevCareerCompass{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h2 mb-0">
                <i class="fas fa-chart-line"></i> Analyze Developer
            </h1>
            <p class="text-muted">Get AI-powered career insights for any GitHub developer</p>
        </div>
    </div>

    <!-- Analysis Form -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-search"></i> Enter GitHub Username
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" id="analyzeForm">
                        <div class="mb-4">
                            <label for="github_username" class="form-label">GitHub Username</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fab fa-github"></i>
                                </span>
                                <input type="text" 
                                       class="form-control form-control-lg" 
                                       id="github_username" 
                                       name="github_username" 
                                       placeholder="e.g., torvalds, antirez, gvanrossum"
                                       required>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-search"></i> Analyze
                                </button>
                            </div>
                            <div class="form-text">
                                Enter a valid GitHub username to analyze their career profile and get AI-powered insights.
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Analysis Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="mb-4">Quick Analysis</h3>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="mb-3">
                        <i class="fas fa-user-circle fa-3x text-primary"></i>
                    </div>
                    <h5 class="card-title">Profile Analysis</h5>
                    <p class="card-text">
                        Analyze GitHub profile, repositories, and activity patterns to understand career trajectory.
                    </p>
                    <button class="btn btn-outline-primary" onclick="quickAnalyze('profile')">
                        <i class="fas fa-chart-bar"></i> Profile Insights
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="mb-3">
                        <i class="fas fa-code fa-3x text-success"></i>
                    </div>
                    <h5 class="card-title">Skills Assessment</h5>
                    <p class="card-text">
                        Identify technical skills, programming languages, and technologies from repositories.
                    </p>
                    <button class="btn btn-outline-success" onclick="quickAnalyze('skills')">
                        <i class="fas fa-tools"></i> Skills Analysis
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="mb-3">
                        <i class="fas fa-route fa-3x text-warning"></i>
                    </div>
                    <h5 class="card-title">Career Prediction</h5>
                    <p class="card-text">
                        Get AI-powered predictions about career trajectory, salary expectations, and growth opportunities.
                    </p>
                    <button class="btn btn-outline-warning" onclick="quickAnalyze('career')">
                        <i class="fas fa-crystal-ball"></i> Career Forecast
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sample Developers -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="mb-4">Sample Developers</h3>
            <p class="text-muted">Try analyzing these well-known developers to see the AI in action:</p>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-md-3 col-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="mb-2">
                        <i class="fas fa-user-circle fa-2x text-primary"></i>
                    </div>
                    <h6 class="card-title">Linus Torvalds</h6>
                    <p class="card-text small text-muted">Linux Creator</p>
                    <button class="btn btn-sm btn-primary" onclick="analyzeSample('torvalds')">
                        Analyze
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="mb-2">
                        <i class="fas fa-user-circle fa-2x text-success"></i>
                    </div>
                    <h6 class="card-title">Salvatore Sanfilippo</h6>
                    <p class="card-text small text-muted">Redis Creator</p>
                    <button class="btn btn-sm btn-success" onclick="analyzeSample('antirez')">
                        Analyze
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="mb-2">
                        <i class="fas fa-user-circle fa-2x text-warning"></i>
                    </div>
                    <h6 class="card-title">Guido van Rossum</h6>
                    <p class="card-text small text-muted">Python Creator</p>
                    <button class="btn btn-sm btn-warning" onclick="analyzeSample('gvanrossum')">
                        Analyze
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center">
                    <div class="mb-2">
                        <i class="fas fa-user-circle fa-2x text-info"></i>
                    </div>
                    <h6 class="card-title">Brad Fitzpatrick</h6>
                    <p class="card-text small text-muted">Go Contributor</p>
                    <button class="btn btn-sm btn-info" onclick="analyzeSample('bradfitz')">
                        Analyze
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Results Modal -->
    <div class="modal fade" id="analysisModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-chart-line"></i> Analysis Results
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="analysisResults">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Analyzing developer profile...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form submission
    document.getElementById('analyzeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('github_username').value.trim();
        if (username) {
            analyzeDeveloper(username);
        }
    });
});

function analyzeDeveloper(username) {
    // Show loading state
    const submitBtn = document.querySelector('#analyzeForm button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
    submitBtn.disabled = true;

    // Make API call
    fetch('/api/analyze_developer', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ github_username: username })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAnalysisResults(data);
        } else {
            showError(data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showError('Failed to analyze developer. Please try again.');
    })
    .finally(() => {
        // Reset button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
}

function showAnalysisResults(data) {
    const modal = new bootstrap.Modal(document.getElementById('analysisModal'));
    const resultsDiv = document.getElementById('analysisResults');
    
    resultsDiv.innerHTML = `
        <div class="row">
            <!-- Developer Info -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <i class="fas fa-user-circle fa-4x text-primary"></i>
                        </div>
                        <h5 class="card-title">${data.developer.name || data.developer.username}</h5>
                        <p class="text-muted">@${data.developer.username}</p>
                        <div class="row text-center">
                            <div class="col-6">
                                <h6 class="mb-0">${data.developer.followers.toLocaleString()}</h6>
                                <small class="text-muted">Followers</small>
                            </div>
                            <div class="col-6">
                                <h6 class="mb-0">${data.developer.public_repos}</h6>
                                <small class="text-muted">Repositories</small>
                            </div>
                        </div>
                        <hr>
                        <p class="mb-1"><strong>Location:</strong> ${data.developer.location || 'Unknown'}</p>
                        <p class="mb-0"><strong>Company:</strong> ${data.developer.company || 'Unknown'}</p>
                    </div>
                </div>
            </div>
            
            <!-- Career Prediction -->
            <div class="col-md-8">
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-header bg-transparent">
                        <h6 class="mb-0"><i class="fas fa-chart-line"></i> Career Prediction</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="text-primary">${data.analysis.career_prediction.predicted_role}</h5>
                                <p class="mb-2">
                                    <span class="badge bg-success">${(data.analysis.career_prediction.confidence * 100).toFixed(1)}% Confidence</span>
                                </p>
                                <p class="mb-2"><strong>Timeline:</strong> ${data.analysis.career_prediction.timeline_months} months</p>
                                <p class="mb-2"><strong>Salary Range:</strong> ${data.analysis.career_prediction.salary_range}</p>
                                <p class="mb-0"><strong>Market Demand:</strong> ${data.analysis.career_prediction.market_demand}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>Required Skills:</h6>
                                <div class="d-flex flex-wrap gap-1">
                                    ${data.analysis.career_prediction.required_skills.map(skill => 
                                        `<span class="badge bg-light text-dark">${skill}</span>`
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Deep Learning Insights -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-transparent">
                        <h6 class="mb-0"><i class="fas fa-brain"></i> Deep Learning Analysis</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Career Path Prediction:</h6>
                                <p class="mb-2">${data.analysis.deep_learning.career_prediction.predicted_role}</p>
                                <p class="mb-0">
                                    <span class="badge bg-info">${(data.analysis.deep_learning.career_prediction.confidence * 100).toFixed(1)}% Confidence</span>
                                </p>
                            </div>
                            <div class="col-md-6">
                                <h6>Salary Prediction:</h6>
                                <p class="mb-2">${data.analysis.deep_learning.salary_prediction.salary_range}</p>
                                <p class="mb-0">
                                    <span class="badge bg-warning">${(data.analysis.deep_learning.salary_prediction.confidence * 100).toFixed(1)}% Confidence</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    modal.show();
}

function showError(message) {
    const modal = new bootstrap.Modal(document.getElementById('analysisModal'));
    const resultsDiv = document.getElementById('analysisResults');
    
    resultsDiv.innerHTML = `
        <div class="text-center">
            <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
            <h5>Analysis Failed</h5>
            <p class="text-muted">${message}</p>
            <button class="btn btn-primary" data-bs-dismiss="modal">Close</button>
        </div>
    `;
    
    modal.show();
}

function quickAnalyze(type) {
    const username = document.getElementById('github_username').value.trim();
    if (!username) {
        alert('Please enter a GitHub username first.');
        return;
    }
    
    // You can implement specific analysis types here
    analyzeDeveloper(username);
}

function analyzeSample(username) {
    document.getElementById('github_username').value = username;
    analyzeDeveloper(username);
}
</script>
{% endblock %} 